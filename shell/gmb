#!/bin/sh
# 7/29/2021 note: maybe leverage vroom or another config file to make "main" branch a project default instead of a profile-level override
usage="$(basename "$0") Resets or stashes working branch, switches to either master or provided branch, and fetches. \
If stashed, pop stash.
  -d Reset before switching branches"

while getopts ':hd' option; do
  case "$option" in
    h) echo "$usage"
       exit
      ;;
    d) delete="true"
      ;;
  esac
done
shift $((OPTIND -1))

changes="$(git diff HEAD)"
echo "ha $changes"
BRANCH=master
original=$(git branch | grep \* | cut -d ' ' -f2)
if [ -n "$MASTER_OVERRIDE" ] ; then
  BRANCH="$MASTER_OVERRIDE"
fi
if [ -n "$1" ] ; then
    BRANCH="$1"
fi

if [ -n "$changes" ] && [ "$delete" != "true" ] ; then
  git stash
fi

git reset --hard
git switch "$BRANCH"
git fetch
git reset --hard origin/"$BRANCH"

if [ -n "$changes" ] && [ "$delete" != "true" ] ; then
  git stash pop
fi
